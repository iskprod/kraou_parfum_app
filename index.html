<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ุชุทุจูู ุชุชุจุน ุงููุจูุนุงุช ูุงูุฃุฑุจุงุญ</title>
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#ffffff" />

    <style>
      * {
        box-sizing: border-box;
      }
      body {
        font-family: Arial;
        padding: 20px;
        background: #f5f5f5;
      }
      h2 {
        color: #333;
      }
      section {
        background: white;
        padding: 15px 25px;
        margin-bottom: 20px;
        border-radius: 8px;
        box-shadow: 0 0 5px #ccc;
      }
      label {
        display: block;
        margin-top: 10px;
      }
      input,
      select,
      button {
        padding: 8px;
        margin-top: 5px;
        width: 100%;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }
      th,
      td {
        border: 1px solid #ccc;
        padding: 8px;
        text-align: center;
      }
      canvas {
        max-width: 100%;
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <h2>๐ ุชุชุจุน ุงููุจูุนุงุช ูุงูุฃุฑุจุงุญ</h2>

    <section>
      <h3>โ ุฅุถุงูุฉ ููุชุฌ</h3>
      <label>ุงุณู ุงูููุชุฌ: <input id="productName" /></label>
      <label>ุงููููุฉ: <input id="productQty" type="number" /></label>
      <label
        >ุฑุฃุณ ุงููุงู ููููููุฉ ุงููุงุญุฏุฉ (ุฏุฑูู):
        <input id="productCost" type="number"
      /></label>
      <label
        >ุณุนุฑ ุงูุจูุน ููููููุฉ ุงููุงุญุฏุฉ (ุฏุฑูู):
        <input id="productSell" type="number"
      /></label>
      <label
        >ูู ูู ููุชุฌ ุดุฑุงูุฉุ
        <select id="isShared">
          <option value="ูุง">ูุง</option>
          <option value="ูุนู">ูุนู</option>
        </select>
      </label>
      <label>ุงุณู ุงูุดุฑูู (ุฅุฐุง ููุฌุฏ): <input id="partnerName" /></label>
      <button onclick="addProduct()">โ ุญูุธ ุงูููุชุฌ</button>
    </section>

    <section>
      <h3>๐ฐ ุชุณุฌูู ุนูููุฉ ุจูุน</h3>
      <label
        >ุงุฎุชุฑ ุงูููุชุฌ:
        <select id="saleProduct"></select>
      </label>
      <label>ุงููููุฉ ุงููุจุงุนุฉ: <input id="saleQty" type="number" /></label>
      <button onclick="recordSale()">๐พ ุชุณุฌูู ุงูุจูุน</button>
      <div id="saleMsg"></div>
    </section>

    <section>
      <h3>๐ ุชุณุฌูู ูุตุฑูู</h3>
      <label>ุงููุตู: <input id="expenseDesc" /></label>
      <label>ุงููุจูุบ (ุฏุฑูู): <input id="expenseAmt" type="number" /></label>
      <button onclick="addExpense()">โ ุญูุธ ุงููุตุฑูู</button>
    </section>

    <section>
      <h3>๐ ุชูุงุฑูุฑ ุงูุฃุฑุจุงุญ ูุงููุตุงุฑูู</h3>
      <canvas id="reportChart"></canvas>
      <div id="summary"></div>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      let products = [],
        sales = [],
        expenses = [];

      function addProduct() {
        const name = document.getElementById("productName").value;
        const qty = parseInt(document.getElementById("productQty").value);
        const cost = parseFloat(document.getElementById("productCost").value);
        const sell = parseFloat(document.getElementById("productSell").value);
        const shared = document.getElementById("isShared").value === "ูุนู";
        const partner = document.getElementById("partnerName").value;

        products.push({ name, qty, cost, sell, shared, partner });
        updateProductSelect();
        alert("โ๏ธ ุชู ุญูุธ ุงูููุชุฌ");
      }

      function updateProductSelect() {
        const select = document.getElementById("saleProduct");
        select.innerHTML = "";
        products.forEach((p, i) => {
          select.innerHTML += `<option value="${i}">${p.name}</option>`;
        });
      }

      function recordSale() {
        const index = document.getElementById("saleProduct").value;
        const qtySold = parseInt(document.getElementById("saleQty").value);
        const product = products[index];
        if (qtySold > product.qty) return alert("โ ุงููููุฉ ุบูุฑ ูุชููุฑุฉ");

        const totalSell = qtySold * product.sell;
        const totalCost = qtySold * product.cost;
        const profit = totalSell - totalCost;
        const partnerShare = product.shared ? profit / 2 : 0;
        const myShare = profit - partnerShare;

        product.qty -= qtySold;
        sales.push({
          name: product.name,
          qtySold,
          totalSell,
          totalCost,
          myShare,
          partnerShare,
          partner: product.partner,
        });

        document.getElementById(
          "saleMsg"
        ).innerText = `โ๏ธ ุชู ุงูุจูุน. ุฑุจุญู: ${myShare} ุฏุฑููุ ูุตูุจ ุงูุดุฑูู: ${partnerShare} ุฏุฑูู`;
        drawChart();
        updateSummary();
      }

      function addExpense() {
        const desc = document.getElementById("expenseDesc").value;
        const amt = parseFloat(document.getElementById("expenseAmt").value);
        expenses.push({ desc, amt });
        alert("โ๏ธ ุชู ุญูุธ ุงููุตุฑูู");
        drawChart();
        updateSummary();
      }

      function drawChart() {
        const totalMyProfit = sales.reduce((sum, s) => sum + s.myShare, 0);
        const totalExpenses = expenses.reduce((sum, e) => sum + e.amt, 0);

        const ctx = document.getElementById("reportChart");
        new Chart(ctx, {
          type: "bar",
          data: {
            labels: ["ุงูุฃุฑุจุงุญ", "ุงููุตุงุฑูู"],
            datasets: [
              {
                label: "ุจุงูุฏุฑูู",
                data: [totalMyProfit, totalExpenses],
                backgroundColor: ["#4caf50", "#f44336"],
              },
            ],
          },
        });
      }

      function updateSummary() {
        const totalMyProfit = sales.reduce((sum, s) => sum + s.myShare, 0);
        const totalExpenses = expenses.reduce((sum, e) => sum + e.amt, 0);
        const dueToPartners = sales.reduce((sum, s) => sum + s.partnerShare, 0);
        document.getElementById("summary").innerHTML = `
        <p>๐ต <strong>ุฑุจุญู ุงูุตุงูู:</strong> ${
          totalMyProfit - totalExpenses
        } ุฏุฑูู</p>
        <p>๐ค <strong>ูุง ูุฌุจ ุฏูุนู ููุดุฑูุงุก:</strong> ${dueToPartners} ุฏุฑูู</p>
      `;
      }
    </script>

    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("service-worker.js")
            .then((reg) => console.log("โ Service Worker ูุณุฌู"))
            .catch((err) => console.error("โ ูุดู ุงูุชุณุฌูู", err));
        });
      }
    </script>
  </body>
</html>
